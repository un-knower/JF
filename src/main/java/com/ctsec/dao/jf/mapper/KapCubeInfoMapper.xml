<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ctsec.dao.jf.KapCubeInfoMapper">
  <resultMap id="BaseResultMap" type="com.ctsec.model.jf.KapCubeInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 18 19:30:19 CST 2017.
    -->
    <constructor>
      <idArg column="init_date" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <idArg column="cube_name" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="project_name" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="model_name" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="cube_owner" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="cube_end_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="update_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 18 19:30:19 CST 2017.
    -->
    init_date, cube_name, project_name, model_name, cube_owner, cube_end_time, update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 18 19:30:19 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from kap_cube_info
    where init_date = #{init_date,jdbcType=INTEGER}
      and cube_name = #{cube_name,jdbcType=VARCHAR}
  </select>

  <sql id="Date_Column_List">
    cube_name, max(SUBSTR(DATE_ADD(DATE(cube_end_time),INTERVAL -1 day),1,10)) as last_build_date,
    max(SUBSTR(DATE(cube_end_time),1,10)) as real_last_build_date
  </sql>
  
  <sql id="Cube_Name_List">
    'c_kpi_dashboard_daily_data_01','c_jy_k_day_01','c_branch_dashboard_01',
    'c_trade_statistics_detail_01','c_trade_statistics_daily_01','c_trade_statistics_weekly_01',
    'c_trade_statistics_monthly_01','c_trade_statistics_yearly_01','c_asset_change_detail_daily_01',
    'c_asset_change_daily_01','c_asset_change_monthly_01','c_coop_statistics_01','c_coop_client_01',
    'c_restricted_statistics_01','c_restricted_statistics_01','c_open_client_statistics_01'
    ,'c_asset_section_statistics_01','c_margin_trading_statistics_01','c_cashclient_asset_01',
    'c_cashclient_redemption_01','c_cashclient_business_01',
    'c_cashclient_business_01','c_related_trade_statistics_01'
  </sql>
  
  <select id="selectAll" resultType="com.ctsec.vo.CubeInfo">
    select
    <include refid="Date_Column_List" />
    from jfpt.kap_cube_info
    where cube_name in (
    <include refid="Cube_Name_List" />
    )
    group by cube_name
  </select>

  <select id="selectOne" resultType="com.ctsec.vo.CubeInfo">
    select
    <include refid="Date_Column_List" />
    from jfpt.kap_cube_info
    where cube_name = #{cubeName}
    group by cube_name
  </select>
  
</mapper>